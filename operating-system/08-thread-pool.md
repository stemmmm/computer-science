# 스레드 풀

<details>  
<summary><h3>스레드 풀의 개념과 필요성에 대해 설명하세요.</h3></summary>

- 스레드 풀은 일정 수의 스레드를 미리 생성해 두고 재사용하는 기법임
- 스레드를 사용할 때마다 새로 생성하는 것보다 스레드 풀의 미리 생성된 스레드를 재사용하는 것이 효율적임
- 스레드 풀을 사용하면 스레드 생성 비용을 줄일 수 있고, 전체 스레드 수를 제한하여 자원 낭비를 방지할 수 있음
</details>

<details>  
<summary><h3>스레드 풀의 동작 방식에 대해 설명하세요.</h3></summary>

1. 초기 작업 요청이 들어오면, 코어 풀 사이즈(Core Pool Size)만큼 스레드가 생성되어 즉시 작업 처리
2. 코어 스레드가 모두 바쁠 상태에서 추가 작업 요청이 들어오면, 해당 작업은 큐에 저장됨
3. 큐가 가득 차 있을 경우, 최대 풀 사이즈(Maximum Pool Size)까지 추가 스레드를 생성하여 작업 처리
4. 큐가 가득 차고 현재 스레드 수가 최대 풀 사이즈에 도달한 상황에서 추가 작업 요청이 들어오면, 예외(`RejectedExecutionException`)가 발생하며 요청 거절 
5. 일정 유휴 시간 동안 추가 작업이 없으면, 스레드가 정리되어 코어 풀 사이즈만큼만 유지됨
</details>

<details>  
<summary><h3>자바 `Executor`를 사용한 스레드 풀 전략에 대해 설명하세요.</h3></summary>

##### 단일 스레드 풀 전략
- `Executors.newSingleThreadExecutor()` 메서드로 생성할 수 있음
- 코어 스레드 1개만 사용함
- `LinkedBlockingQueue`를 사용하여 큐의 크기에 제한이 없음
- 주로 간단한 작업 처리나 테스트 용도로 사용됨 

##### 고정 스레드 풀 전략
- `Executors.newFixedThreadPool(nThreads)` 메서드로 생성할 수 있음
- 고정된 수(`nThread`개)의 코어 스레드를 생성하며, `nThread`개 이상으로는 추가 스레드를 생성하지 않음
- `LinkedBlockingQueue`를 사용하여 큐의 크기에 제한이 없음 
- 스레드 수가 고정되어 있어, CPU 및 메모리 리소스 사용량이 예측 가능하므로 안정적인 서비스 운영이 가능함
- 그러나 사용자 수가 점차 증가하거나, 갑자기 많은 작업이 몰리는 경우 서비스 응답 속도가 느려질 수 있음
- 즉, 서버의 자원은 충분하지만 작업 처리가 지연되어 사용자 응답 속도가 저하되는 문제가 발생할 수 있음

##### 캐시 스레드 풀 전략
- `Executors.newCachedThreadPool()` 메서드로 생성할 수 있음
- 코어 스레드가 0개이고, 추가 스레드 개수에는 제한이 없음
- 60초의 생존 주기를 가진 추가 스레드만 사용하며, 60초가 지나도록 유휴 상태이면 스레드는 제거됨
- 요청이 증가함에 따라 스레드 수도 빠르게 증가하고, 요청이 줄어들면 스레드 수도 함께 줄어듦
- 추가 스레드 수의 제한이 없으므로, CPU와 메모리 리소스가 허용하는 최대치까지 스레드가 생성될 수 있음
- `SynchronousQueue`를 사용해 큐에 작업을 저장하지 않고, 생산자 스레드가 소비자 스레드에게 작업을 직접 전달함
- 따라서 모든 요청을 대기 없이 처리할 수 있므으로 빠른 처리가 가능함
- 서버의 자원을 최대한 활용할 수 있지만, 무제한으로 스레드가 생성될 수 있기에 서버가 감당할 수 있는 임계점을 넘으면 시스템이 다운될 위험이 있음

##### 커스텀 스레드 풀 전략
- 상황에 따라 고정 스레드 풀 전략과 캐시 스레드 풀 전략의 장점을 결합한 커스텀 스레드 풀을 정의하여 사용할 수 있음
- 시스템이 감당할 수 없는 정도로 사용자 요청이 폭증할 경우, 최악의 상황인 시스템 다운을 방지하기 위해 처리 가능한 수준의 요청만 수락하고, 나머지 요청은 거절해야 함

> **Tip**  
> 스레드 풀 전략을 선택할 때, 미래를 예측한 과최적화보다는 현재 시스템 상황에 적합한 전략을 선택하는 것이 권장됨  
> 일반적으로 고정 스레드 풀 또는 캐시 스레드 풀 전략만으로도 충분히 안정적으로 시스템을 운영할 수 있음
</details>